<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CRUD APP Sample</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- React-Bootstrap CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/react-bootstrap@2.7.4/dist/react-bootstrap.min.js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
    }

    header {
      background-color: #003366;
      color: white;
      padding: 0.5rem 1rem;
      position: fixed;
      top: 0;
      width: 100%;
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    header h1 {
      margin: 0;
      font-size: 1.5rem;
    }

    .container {
      margin-top: 4rem;
    }

    .form-container {
      position: sticky;
      top: 4rem;
      padding: 1rem;
      background: #f8f9fa;
      border-radius: 5px;
    }

    .content-container {
      overflow-y: auto;
      max-height: calc(100vh - 4rem);
    }

    @media (min-width: 768px) {
      .layout {
        display: flex;
        gap: 1rem;
      }

      .form-container {
        flex: 1;
      }

      .content-container {
        flex: 2;
      }
    }

    @media (max-width: 767px) {
      .form-container {
        margin-bottom: 1rem;
      }

      .layout {
        flex-direction: column;
      }
    }
  </style>
</head>

<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;
    const API_BASE = "http://localhost:5000/api/items";

    function App() {
      const [formData, setFormData] = useState({
        name: "",
        company: "",
        mobileNumber: "",
        description: "",
      });
      const [items, setItems] = useState([]);
      const [isEditing, setIsEditing] = useState(null);

      const fetchItems = async () => {
        try {
          const response = await fetch(API_BASE);
          const data = await response.json();
          setItems(data);
        } catch (error) {
          console.error("Error fetching items:", error);
        }
      };

      useEffect(() => {
        fetchItems();
      }, []);

      const handleSubmit = async (e) => {
        e.preventDefault();
        const existingItem = items.find(
          (item) =>
            item.name === formData.name &&
            item.mobileNumber === formData.mobileNumber
        );

        if (existingItem) {
          alert("Item with the same name and mobile number already exists.");
          setFormData({ name: "", company: "", mobileNumber: "", description: "" });
          return;
        }

        if (isEditing) {
          await handleUpdate();
          return;
        }

        try {
          await fetch(API_BASE, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(formData),
          });
          fetchItems();
          setFormData({ name: "", company: "", mobileNumber: "", description: "" });
        } catch (error) {
          console.error("Error adding item:", error);
        }
      };

      const handleUpdate = async () => {
        try {
          await fetch(`${API_BASE}/${isEditing}`, {
            method: "PUT",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(formData),
          });
          fetchItems();
          setFormData({ name: "", company: "", mobileNumber: "", description: "" });
          setIsEditing(null);
        } catch (error) {
          console.error("Error updating item:", error);
        }
      };

      const handleEdit = (item) => {
        setFormData(item);
        setIsEditing(item.id);
      };

      const handleDelete = async (id) => {
        console.log('id: ', id)
        if (!id) {
          console.error("Invalid ID provided for deletion.");
          return;
        }
        try {
          await fetch(`${API_BASE}/${id}`, {
            method: "DELETE",
          });
          fetchItems();
        } catch (error) {
          console.error("Error deleting item:", error);
        }
      };


      return (
        <>
          <header>
            <h1>CRUD App</h1>
          </header>

          <div className="container layout">
            <div className="form-container">
              <form onSubmit={handleSubmit} className="mb-4">
                <div className="mb-3">
                  <label className="form-label">Name</label>
                  <input
                    type="text"
                    className="form-control"
                    value={formData.name}
                    onChange={(e) =>
                      setFormData({ ...formData, name: e.target.value })
                    }
                    required
                  />
                </div>
                <div className="mb-3">
                  <label className="form-label">Company</label>
                  <input
                    type="text"
                    className="form-control"
                    value={formData.company}
                    onChange={(e) =>
                      setFormData({ ...formData, company: e.target.value })
                    }
                    required
                  />
                </div>
                <div className="mb-3">
                  <label className="form-label">Mobile Number</label>
                  <input
                    type="tel"
                    className="form-control"
                    value={formData.mobileNumber}
                    onChange={(e) =>
                      setFormData({ ...formData, mobileNumber: e.target.value })
                    }
                    required
                  />
                </div>
                <div className="mb-3">
                  <label className="form-label">Description</label>
                  <textarea
                    className="form-control"
                    rows="3"
                    value={formData.description}
                    onChange={(e) =>
                      setFormData({ ...formData, description: e.target.value })
                    }
                    required
                  ></textarea>
                </div>
                <button type="submit" className="btn btn-primary w-100">
                  {isEditing ? "Update" : "Submit"}
                </button>
              </form>
            </div>

            <div className="content-container">
              <div className="row">
                {items.map((item, index) => (
                  <div key={item.id || index} className="col-12 mb-4">
                    <div className="card h-100">
                      <div className="card-body">
                        <h5 className="card-title">{item.name}</h5>
                        <p className="card-text">Company: {item.company}</p>
                        <p className="card-text">Mobile: {item.mobileNumber}</p>
                        <p className="card-text">Description: {item.description}</p>
                        <button
                          className="btn btn-warning me-2"
                          onClick={() => handleEdit(item)}
                        >
                          Update
                        </button>
                        <button
                          className="btn btn-danger"
                          onClick={() => handleDelete(item.id)}
                        >
                          Delete
                        </button>
                      </div>
                    </div>
                  </div>
                ))}
              </div>

            </div>
          </div>

          <footer className="mt-4 py-3 text-center" style={{ backgroundColor: "#003366", color: "white" }}>
            <p className="mb-0">CRUD App Â© 2024. All rights reserved.</p>
            <small>Designed with React and Bootstrap.</small>
          </footer>
        </>
      );
    }

    const rootElement = document.getElementById("root");
    const root = ReactDOM.createRoot(rootElement);
    root.render(<App />);

  </script>
</body>

</html>